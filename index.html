
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Bede Engineering</title>
  <meta name="author" content="Bede Gaming Ltd">

  
  <meta name="description" content="Microservices have gained more and more popularity in the software community during the past couple of years, up to the point that SkillsMatter has &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://engineering.bedegaming.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Bede Engineering" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:engineering.bedegaming.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">
            Bede Engineering
    </a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/10/bede-gaming-at-ucon-2014/">Bede Gaming at µCon 2014</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-12-10T14:15:55+00:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Microservices have gained more and more popularity in the software community during the past couple of years, up to the point that SkillsMatter has dedicated them an entire convention in London, µCon. I was lucky enough to participate  and here are some of the ideas that have been discussed.</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/12/10/bede-gaming-at-ucon-2014/">more &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/09/Adding-InstancePerRequest-to-Non-Web-Apps/">Adding InstancePerRequest to Non-Web Applications</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-12-09T16:02:00+00:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here at Bede we use <a href="http://autofac.org/">Autofac</a> a lot. It&rsquo;s an excellent <a href="http://en.wikipedia.org/wiki/Inversion_of_control">IoC</a> container which allows us to create well structured code focused on interfaces rather than implementations. If you are not familiar with IoC, or it&rsquo;s most commonly used form of <a href="http://en.wikipedia.org/wiki/Dependency_injection">Dependency Injection</a>, I&rsquo;d suggest the essential (.NET) reading of <a href="http://www.amazon.co.uk/Dependency-Injection-NET-Mark-Seemann/dp/1935182501">Dependency Injection in .NET</a> as a primer.</p>

<p>A typical basic example would be at the beginning of our application (called the &ldquo;composition root&rdquo;) to do something like</p>

<pre><code>var builder = new ContainerBuilder();
builder.RegisterType&lt;MyWorkService&gt;().As&lt;IWorkService&gt;();
_container = builder.Build();
</code></pre>

<p>This says that any time someone asks for an <code>IWorkService</code> that they should have that satisfied with a <code>MyWorkService</code> implementation. This leaves you free to write code like</p>

<pre><code>public class MyController : ApiController
{
    private readonly IWorkService _workService;

    public ProfilesController(IWorkService workService)
    {
        _workService  = workService;
    }
}
</code></pre>

<p>&hellip;and not be worried about where that <code>IWorkService</code> is going to come from. It&rsquo;s a critical pattern for clean, re-usable, testable code, and one we use consistently throughout the business in all our apps.</p>

<h2>IoC Containers and the Web - Instance Per Request</h2>

<p>IoC containers like Autofac come ready prepared to hook into web and API applications (my example controller above would fail to run if I had not hooked up Autofac). We find ourselves naturally starting to depend upon Autofacs built in help for scoping dependencies. For example if we changed the <code>IWorkService</code> registration above to</p>

<pre><code>var builder = new ContainerBuilder();
builder.RegisterType&lt;MyWorkService&gt;().As&lt;IWorkService&gt;().InstancePerRequest();
_container = builder.Build();
</code></pre>

<p>We actually change <em>when</em> a new <code>MyWorkService</code> is constructed. Before it would be <em>any time</em> a contructor asked for an <code>IWorkService</code>. Now it is only once for each web request. We could go a step further and do</p>

<pre><code>var builder = new ContainerBuilder();
builder.RegisterType&lt;MyWorkService&gt;().As&lt;IWorkService&gt;().SingleInstance();
_container = builder.Build();
</code></pre>

<p>&hellip;and now we will only ever construct one object and hand it out every time we are asked to satisfy the <code>IWorkService</code> class.</p>

<p>These techniques are excellent - because it allows us to ensure that objects that are &ldquo;costly&rdquo; to instantiate are only constructed when absolutely needed, and further, items that are created once &ldquo;per request&rdquo; in a web application can essentially persist context of that request within the service (username, request parameters, caller IP Address, etc.)</p>

<p>We leverage the &ldquo;InstancePerRequest&rdquo; for several contextual services, as it means that you can assign context values to service properties, rather than as parameters of its methods. For example:</p>

<pre><code>public ProfilesController(IWorkService workService)
{
    _workService  = workService;
}

public HttpResponseMessage Update(Profile profile)
{
    List&lt;string&gt; values;
    Request.Headers.TryGetValues("userAppKey", out values)
    _workService.AppKey = values[0];

    ...

    _workService.DoStuff(profile);
    _workService.DoMoreStuff();
}
</code></pre>

<p>This is great, as we now don&rsquo;t have to add the &ldquo;userAppKey&rdquo; to each and every method signature.</p>

<h2>Instance Per Request for non-web applications</h2>

<p>It&rsquo;s great that Autofac has such rich built in support for ASP.NET MVC and WebApi applications, but sometimes you are working other forms of application that appear to meet the same pattern. A classic example of this is any &ldquo;message processing application&rdquo; - for example, an azure worker role that listens for Azure Service Bus messages, but it could be any message consumer (including just listening on a socket for data). In such cases your context is the message that arrives, and in reality this is no different to an Http request - its just a message format we have all gotten really used to.</p>

<p>So how do we deal with providing an &ldquo;Instance Per Request&rdquo; in these scenarios? Thankfully Autofac is fully designed to help us out here.</p>

<h2>Scoping our Request</h2>

<p>Autofac allows you to create a <code>scope</code> at any time in your code. If you register your dependencies correctly, using <code>InstancePerLifetimeScope</code>, Autofac will construct a new object inside that scope if none already exists</p>

<pre><code>builder.RegisterType&lt;MyWorkService&gt;().As&lt;IWorkService&gt;().InstancePerLifetimeScope();
</code></pre>

<p>We can make our own scope as follows:</p>

<pre><code>static void Main(string[] args)
{
    //Composition Root
    var builder = new ContainerBuilder();
    builder.RegisterType&lt;MyWorkService&gt;().As&lt;IWorkService&gt;().InstancePerLifetimeScope();
    builder.RegisterType&lt;MyOneOfAKindService&gt;().As&lt;IOneOfAKindService&gt;().InstancePerLifetimeScope();
    _container = builder.Build();

    var rootScope = _container.BeginLifetimeScope();
    for (int i = 0; i &lt; 5; i++)
    {
        var oneOfAKind = rootScope.Resolve&lt;IOneOfAKindService&gt;();

        using (var scope = _container.BeginLifetimeScope()) 
        {
            Console.WriteLine("Handing Event " + i);

            // we will get a one and only one instance for each iteration of the for loop, no matter
            //how many times we call scope.Resolve&lt;IWorkService&gt;()
            HandledEvent(oneOfAKind, scope.Resolve&lt;IWorkService&gt;()); 
        }
    }

    Console.ReadKey();
}
</code></pre>

<p>Here we use the <code>Resolve</code> method on a scope to get hold of our implementation. Autofac checks how you registered the implementation against the interface, and decides when to give you a new instance or a current one. We can make this more specific, and basically create our own &ldquo;InstancePerRequest&rdquo; registration with:</p>

<pre><code>builder.RegisterType&lt;MessageContext&gt;().As&lt;IMessageContext&gt;().InstancePerLifetimeScope("MessageRequest");

using (var scope = _container.BeginLifetimeScope("MessageRequest")) 
{
    //...
    var context = scope.Resolve&lt;IMessageContext&gt;();
    var message = GetRawMessageFromBus();
    MapMessageToContext(message, context);

    //assume that this is overridden, and/or leads to construction of an object that takes 
    //an IMessageContext interface
    HandleMessage(context); 
}
</code></pre>

<p>The code above is fairly basic, but proves the point. Revise it and package it up a little and you can a context aware framework that works very nicely with Autofac.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/01/waste-in-software/">Waste in Software</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-12-01T16:49:00+00:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of several interesting areas to come out of our tour of Nissan in Sunderland today was how they classify wastage into seven different categories</p>

<ol>
<li><strong>Over-Production</strong>: Making more cars than you need is expensive. you used more people, and now you have to store them somewhere. In the past large car companies might be paying a farmer for use of fields to store the vehicles in until they could be sold. The long term storage is doubly damaging, as rodents tend to love making their homes in the vehicles</li>
<li><strong>Inventory or Stock</strong>: Again, </div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/12/01/waste-in-software/">more &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/24/puppet-redis-module/">Bede Gaming Puppet Module for Redis</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-11-24T16:30:00+00:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As of last week we&rsquo;ve created and released a Puppet Module for Redis.  While there are other Redis modules available on GitHub and the Forge, we think a lot of them are either overly complex or outdated in their design and methods.  Many of them also install from source packages, which we don&rsquo;t like.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/11/24/puppet-redis-module/">more &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/18/puppet-foundationdb-module/">Bede Gaming Puppet Module for FoundationDB</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-11-18T16:30:00+00:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here at Bede we&rsquo;ve been using <a href="https://foundationdb.com/">FoundationDB</a> for some time, and are basically in love with it.  Fully distributed, ACID compliant transactions?  Yes please.  It&rsquo;s fast, it scales, it&rsquo;s reliable and redundant.  From an operations persons point of view it&rsquo;s simply sexy.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/11/18/puppet-foundationdb-module/">more &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/13/bede-sponsors-hackne/">Bede Gaming Sponsors Biggest Hackathon in the North East</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-11-13T09:20:08+00:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Billed as <a href="http://http://www.chroniclelive.co.uk/news/local-news/newcastle-set-north-easts-biggest-8052017">“The biggest public hackathon ever held in the North East”</a>, <a href="http://hackne.com">Hack NE</a>, for Bede, was an ideal opportunity to get our name known in the community.  With a largely student based attendee list, people had come from as far away as London to compete. With free t-shirts, face cloths, breath mints, wet wipes and swag bags, Bede&rsquo;s branded 8Gig USB sticks looked a good addition for those brave enough to come talk to us.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/11/13/bede-sponsors-hackne/">more &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/06/cd-in-action-at-nissan-sunderland/">CD in Action at Nissan Sunderland</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-11-06T12:54:14+00:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The Nissan UK car plant at Sunderland produces almost as many cars every year as Italy’s entire automative industry. It’s a mammoth site.  Each of the four production lines in this factory is capable of producing one car every minute, continuously. As in 24x7x365. True continuous delivery into production. I was lucky enough to be invited on a factory tour by the good people at the <a href="http://www.entrepreneursforum.net">entrepreneurs forum</a> recently. It was fascinating to see how Nissan have engineered every aspect of production to minimise waste and keep the line flowing. At Bede I&rsquo;ve spent a lot of my time trying to enable agile teams to deliver high quality software into production as fast as possible, so after the factory tour my mind was left reeling with comparisons between Nissan and Bede&rsquo;s approaches to Continuous Delivery.</p>

<p><img class="center" src="/images/nissan-plant.jpg" title="Aerial view of Nissan UK plant at Sunderland" alt="Aerial view of Nissan UK plant at Sunderland">
<em>Source: <a href="http://www.themanufacturer.com/articles/nissan-smashes-uk-output-record-at-sunderland-plant/">http://themanufacturer.com</a></em></p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/11/06/cd-in-action-at-nissan-sunderland/">more &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/05/modelling-an-nginx-application-proxy-using-puppet-and-hiera/">Modelling an Nginx Application Proxy Using Puppet and Hiera</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-11-05T15:53:08+00:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Goal</h1>

<p>To model nginx configurations in Hiera, extracting those configurations from the Puppet DSL, and create a Puppet Profile to combine that with the nginx module.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/11/05/modelling-an-nginx-application-proxy-using-puppet-and-hiera/">more &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/20/developers-and-the-changing-mobile-landscape/">How the Current Mobile Landscape Affects Developers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-20T15:55:00+00:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A colleague pointed me towards an interesting <a href="http://www.slideshare.net/robnyman/mobile-trends-web-native">presentation</a> that illustrates some dramatic shifts in the mobile market. I think it&rsquo;s important that mobile app developers take a close look at how this may impact apps they are working on. Here we discuss issues and possible solutions to the problems that may arise.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/10/20/developers-and-the-changing-mobile-landscape/">more &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/16/who-is-your-brent/">Who Is Your Brent?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-16T17:19:00+00:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In the book <a href="http://www.amazon.co.uk/Phoenix-Project-DevOps-Helping-Business-ebook/dp/B00AZRBLHO/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1413480244&amp;sr=1-1&amp;keywords=the+phoenix+project">The Phoenix Project</a> one of the primary foils of the &ldquo;hero&rdquo; is a guy named Brent. Brent is critical to successful work. Production incident? Call Brent. Complex database query? Brent&rsquo;s your guy. Tracing down network packet drops? Brent is already on it.  On the face of it, he is what every ops team wants twenty of, but as the book shows it is easy to become so critically dependent on one person that they become a bottleneck for the organisation. Also, Brent has several bad habits. He drops everything he&rsquo;s doing to sort out what ever is being screamed about loudest, regardless of its actual priority. He&rsquo;s also a knowledge silo - because Brent built half the complex systems in the business, he knows </div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/10/16/who-is-your-brent/">more &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
	<img src="/images/bede-logo.png" border="0">
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/12/10/bede-gaming-at-ucon-2014/">Bede Gaming at µCon 2014</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/09/Adding-InstancePerRequest-to-Non-Web-Apps/">Adding InstancePerRequest to Non-Web Applications</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/01/waste-in-software/">Waste In Software</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/24/puppet-redis-module/">Bede Gaming Puppet Module for Redis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/18/puppet-foundationdb-module/">Bede Gaming Puppet Module for FoundationDB</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/BedeGaming">@BedeGaming</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'BedeGaming',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/Bede_Engineers"  data-widget-id="531784519318134784"  data-link-color="#1863a1" data-tweet-limit="6" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @Bede_Engineers</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </ul>
  
    <a href="http://twitter.com/Bede_Engineers" class="twitter-follow-button" data-show-count="false">Follow @Bede_Engineers</a>
  
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Bede Gaming Ltd -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
